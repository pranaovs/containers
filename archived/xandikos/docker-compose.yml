services:
  xandikos:
    image: ghcr.io/jelmer/xandikos
    ports:
      - 30089:8000
      - 30090:8001
    user: "1000"
    volumes:
      - ./data:/data
    environment:
      # Core settings (all optional - defaults shown)
      # - PORT=8000
      # - METRICS_PORT=8001
      # - LISTEN_ADDRESS=0.0.0.0
      # - DATA_DIR=/data
      # - CURRENT_USER_PRINCIPAL=/user/
      # - ROUTE_PREFIX=/

      # Auto-create directories and default calendar/addressbook
      - AUTOCREATE=true
      - DEFAULTS=true

      # Debug options
      # - DEBUG=false
      # - DUMP_DAV_XML=false

      # Compatibility mode for buggy clients
      # - NO_STRICT=false
    restart: always
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:30090/health"]
      interval: 30s
      timeout: 3s
      start_period: 5s
      retries: 3
