{
  "apps": {
    "layer4": {
      "servers": {
        "main": {
          "listen": [
            ":443"
          ],
          "routes": [
            {
              "match": [
                {
                  "tls": {
                    "sni": [
                      "vaultwarden.deepanalve.dev",
                      "bitwarden.deepanalve.dev",
                      "headscale.pranaovs.me",
                      "photos.pranaovs.me",
                      "immich.pranaovs.me",
                      "fileserver.pranaovs.me"
                    ]
                  }
                }
              ],
              "handle": [
                {
                  "handler": "proxy",
                  "upstreams": [
                    {
                      "dial": [
                        "localhost:8443"
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "handle": [
                {
                  "handler": "proxy",
                  "upstreams": [
                    {
                      "dial": [
                        "shadowbox:443"
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      }
    },
    "http": {
      "servers": {
        "httpsa8443": {
          "listen": [
            ":8443"
          ],
          "routes": [
            {
              "match": [
                {
                  "host": [
                    "vaultwarden.deepanalve.dev",
                    "bitwarden.deepanalve.dev"
                  ]
                }
              ],
              "handle": [
                {
                  "handler": "reverse_proxy",
                  "upstreams": [
                    {
                      "dial": "vaultwarden:80"
                    }
                  ]
                }
              ]
            },
            {
              "match": [
                {
                  "host": [
                    "headscale.pranaovs.me"
                  ]
                }
              ],
              "handle": [
                {
                  "handler": "reverse_proxy",
                  "upstreams": [
                    {
                      "dial": "headscale:8080"
                    }
                  ]
                }
              ]
            },
            {
              "match": [
                {
                  "host": [
                    "fileserver.pranaovs.me"
                  ]
                }
              ],
              "handle": [
                {
                  "handler": "reverse_proxy",
                  "upstreams": [
                    {
                      "dial": "caddy_file_server:80"
                    }
                  ]
                }
              ]
            },
            {
              "match": [
                {
                  "host": [
                    "photos.pranaovs.me",
                    "immich.pranaovs.me"
                  ]
                }
              ],
              "handle": [
                {
                  "handler": "reverse_proxy",
                  "upstreams": [
                    {
                      "dial": "immich_server:2283"
                    }
                  ]
                }
              ]
            }
          ]
        }
      }
    },
    "tls": {
      "automation": {
        "policies": [
          {
            "subjects": [
              "vaultwarden.deepanalve.dev",
              "bitwarden.deepanalve.dev",
              "headscale.pranaovs.me",
              "photos.pranaovs.me",
              "immich.pranaovs.me",
              "fileserver.pranaovs.me"
            ]
          }
        ]
      }
    }
  }
}
